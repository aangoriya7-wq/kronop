syntax = "proto3";

package kronop.core;

// Reel message for real-time updates
message ReelUpdate {
  string id = 1;
  int32 reel_id = 2;
  map<string, string> update_data = 3;
  repeated string target_users = 4;
  string target_channel = 5;
  int64 timestamp = 6;
  Priority priority = 7;
  enum Priority {
    NORMAL = 0;
    HIGH = 1;
    URGENT = 2;
    LOW = 3;
  }
}

// Reel metadata
message ReelMetadata {
  int32 reel_id = 1;
  string title = 2;
  string description = 3;
  string thumbnail_url = 4;
  string video_url = 5;
  int32 duration_ms = 6;
  int32 view_count = 7;
  int32 like_count = 8;
  int32 comment_count = 9;
  int32 share_count = 10;
  int32 save_count = 11;
  bool is_liked = 12;
  bool is_saved = 13;
  bool is_supporting = 14;
  map<string, string> tags = 15;
  int64 created_at = 16;
  int64 updated_at = 17;
  string creator_id = 18;
  map<string, string> creator_metadata = 19;
}

// User interaction with reel
message ReelInteraction {
  string id = 1;
  int32 reel_id = 2;
  string user_id = 3;
  string interaction_type = 4;
  map<string, string> interaction_data = 5;
  int64 timestamp = 6;
}

// Reel view event
message ReelViewEvent {
  string id = 1;
  int32 reel_id = 2;
  string user_id = 3;
  int32 watch_time_ms = 4;
  int32 position_percentage = 5;
  bool completed = 6;
  int64 timestamp = 7;
}

// Reel chunk data
message ReelChunk {
  string id = 1;
  int32 reel_id = 2;
  int32 chunk_index = 3;
  bytes data = 4;
  int32 size_bytes = 5;
  string format = 6;
  int64 timestamp = 7;
  bool is_key_frame = 8;
  int32 sequence_number = 9;
  double compression_ratio = 10;
}

// Reel statistics
message ReelStats {
  int32 reel_id = 1;
  int32 total_chunks = 2;
  int32 cached_chunks = 3;
  int32 streaming_chunks = 4;
  int32 buffer_utilization = 5;
  double avg_fps = 6;
  double decoding_speed = 7;
  int64 total_bytes = 8;
  int64 cache_hits = 9;
  int64 cache_misses = 10;
  int64 cache_hit_ratio = 11;
  int64 last_updated = 12;
}

// User presence information
message UserPresence {
  string user_id = 1;
  string session_id = 2;
  string status = 3;
  map<string, string> metadata = 4;
  map<string, string> activity = 5;
  int64 created_at = 6;
  int64 last_activity = 7;
  bool is_online = 8;
}

// Connection statistics
message ConnectionStats {
  int32 total_connections = 1;
  int32 active_connections = 2;
  int32 max_connections = 3;
  double avg_response_time = 4;
  int32 messages_sent = 5;
  int32 messages_received = 6;
  int64 bytes_sent = 7;
  int64 bytes_received = 8;
  int64 error_count = 9;
  int64 last_updated = 10;
}

// System performance metrics
message SystemMetrics {
  int32 total_users = 1;
  int32 online_users = 2;
  int32 total_sessions = 3;
  int32 active_sessions = 4;
  int32 total_reels = 5;
  int32 active_reels = 6;
  double avg_fps = 7;
  double total_bandwidth = 8;
  int64 total_bytes = 9;
  int64 cache_hit_ratio = 10;
  int64 last_updated = 11;
}

// Real-time event wrapper
message RealTimeEvent {
  string event_type = 1;
  string event_id = 2;
  int64 timestamp = 3;
  map<string, any> data = 4;
}

// Batch update for performance
message BatchReelUpdates {
  repeated ReelUpdate updates = 1;
  int32 batch_id = 2;
  int64 timestamp = 3;
}

// Heartbeat for connection health
message Heartbeat {
  string node_id = 1;
  string status = 2;
  int64 timestamp = 3;
  map<string, any} metrics = 4;
}
